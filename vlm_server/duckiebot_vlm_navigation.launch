<?xml version="1.0"?>
<launch>
  <!-- DuckieBot VLM Navigation Launch File -->
  
  <!-- Arguments -->
  <arg name="robot_name" default="ducky" doc="Name of the DuckieBot"/>
  <arg name="llama_url" default="http://localhost:8080" doc="URL of the llama.cpp server"/>
  <arg name="processing_fps" default="2.0" doc="VLM processing FPS"/>
  <arg name="auto_start" default="true" doc="Start navigation automatically"/>
  
  <!-- Parameters -->
  <param name="use_sim_time" value="false"/>
  
  <!-- VLM Navigation Node -->
  <node name="duckiebot_vlm_navigator" 
        pkg="vlm_server" 
        type="duckiebot_vlm_navigation.py" 
        output="screen"
        args="$(arg robot_name) --llama-url $(arg llama_url) --fps $(arg processing_fps)">
    
    <!-- Remap topics to robot-specific names -->
    <remap from="/cmd_vel" to="/$(arg robot_name)/cmd_vel"/>
    <remap from="/wheels_driver_node/wheels_cmd" to="/$(arg robot_name)/wheels_driver_node/wheels_cmd"/>
    <remap from="/car_cmd_switch_node/cmd" to="/$(arg robot_name)/car_cmd_switch_node/cmd"/>
    
    <!-- Navigation parameters -->
    <param name="max_speed" value="0.15" type="double"/>
    <param name="max_angular" value="1.0" type="double"/>
    <param name="wheel_distance" value="0.1" type="double"/>
    <param name="processing_fps" value="$(arg processing_fps)" type="double"/>
    <param name="auto_control" value="$(arg auto_start)" type="bool"/>
    
    <!-- Safety parameters -->
    <param name="emergency_stop_enabled" value="true" type="bool"/>
    <param name="max_response_time" value="15.0" type="double"/>
    <param name="min_confidence_threshold" value="0.1" type="double"/>
  </node>
  
  <!-- Performance Monitor (optional) -->
  <node name="vlm_performance_monitor" 
        pkg="vlm_server" 
        type="performance_monitor.py" 
        output="screen"
        if="false">
    <param name="monitor_topics" value="/vlm_navigator/performance,/vlm_navigator/current_decision"/>
  </node>
  
  <!-- Emergency Stop Service (optional) -->
  <node name="emergency_stop_service" 
        pkg="vlm_server" 
        type="emergency_stop_service.py" 
        output="screen"
        if="false"/>
  
</launch>
